{% extends 'student/base.html' %}
{% load i18n %}

{% block content %}
    <div class="spacing"></div>
    <div class="container">
        <div class="col-12">
            <h2>Search</h2>
            <form method="post" action="">
                {% csrf_token %}
                {{ form.as_p }}
                {{ form.errors }}
                <button class="btn btn-success" value="Search for Courses">Search for courses</button>
            </form>
        </div>
        <hr/>
        <h2>{{ study }}</h2>
        <br>
        {% for period in periods %}
            <h4>
                {% blocktrans with year=period.year quartile=period.quartile.sorting_index %}
                    Year {{ year }}, Quartile {{ quartile }}
                {% endblocktrans %}
            </h4>
            <hr>
            <div class="row">
                <div class="col-3">
                    <h6>{% trans 'Course Code' %}</h6>
                </div>
                <div class="col-3">
                    <h6>{% trans 'Course Name' %}</h6>
                </div>
                <div class="col-6">
                    <h6>{% trans 'Course Coordinator' %}</h6>
                </div>
            </div>

            {% for course in period.courses %}
                <div class="row">
                    <div class="col-3">{{ course.course_code }}</div>
                    <div class="col-3">{{ course.name }}</div>
                    <div class="col-6">{{ course.coordinator }}</div>
                    <ul class="list-group">
                        {% for msp in course.materials.all %}
                            {% for material in msp.last_line_materials %}
                                {% if material.polymorphic_ctype == 'Book' %}
                                    <div class="card-body p-0">
                                        <table class="table table-striped ">
                                            <tr>
                                                <th>{% trans 'Name' %}</th>
                                                <th>{% trans 'Edition' %}</th>
                                                <th>{% trans 'Author(s)' %}</th>
                                                <th>{% trans 'ISBN' %}</th>
                                                <th>{% trans 'Image' %}</th>
                                            </tr>

                                                <tr>
                                                    <td>
                                                        {{ material.name }}
                                                    </td>
                                                    <td>
                                                        {{ material.edition }}
                                                    </td>
                                                    <td>
                                                        {{ material.author }}
                                                    </td>
                                                    <td>
                                                        {{ material.ISBN }}
                                                    </td>
                                                    <td>
                                                        {% if material.img %}
                                                            <img src="{{ material.img }}" style="height: 50px">
                                                        {% endif %}
                                                    </td>
                                                </tr>
                                        </table>
                                    </div>

                                {% elif material.polymorphic_ctype == 'Scientific Article' %}
                                    <div class="card-body p-0">
                                        <table class="table table-striped">
                                            <tr>
                                                <th>{% trans 'Name' %}</th>
                                                <th>{% trans 'Author(s)' %}</th>
                                                <th>{% trans 'Year of Publishing' %}</th>
                                                <th>{% trans 'DOI' %}</th>
                                            </tr>
                                            {% for material in materials %}
                                                <tr>
                                                    <td>
                                                        {{ material.name }}
                                                    </td>
                                                    <td>
                                                        {{ material.author }}
                                                    </td>
                                                    <td>
                                                        {{ material.year_of_publishing }}
                                                    </td>
                                                    <td>
                                                        <a href="https://dx.doi.org/{{ material.DOI }}"
                                                           target="_blank">
                                                            {{ material.DOI }}
                                                        </a>
                                                    </td>
                                                </tr>
                                            {% endfor %}
                                        </table>
                                    </div>
                                {% else %}
                                    <div class="card-body p-0">
                                        <table class="table table-striped">
                                            <tr>
                                                <th>{% trans 'Name' %}</th>
                                            </tr>
                                            {% for material in materials %}
                                                <tr>
                                                    <td>
                                                        {{ material.name }}
                                                    </td>
                                                </tr>
                                            {% endfor %}
                                        </table>
                                    </div>
                                {% endif %}
                            {% endfor %}
                            <div class="spacing"></div>
{#                            <li class="list-group-item d-flex justify-content-between align-items-center">#}
{#                                <a href="{% url 'teacher:msp.detail' msp.id %}">#}
{#                                    {{ msp.student_str }}#}
{#                                    TODO: make this actually useful information#}
{#                                </a>#}
{#                                <span#}
{#                                        class="badge badge-{{ msp.stage_bootstrap_tab }} badge-pill">#}
{#                                    {{ msp.stage }}#}
{#                                </span>#}
{#                            </li>#}

                        {% empty %}
                            <li class="list-group-item">
                                {% trans "No msps" %}
                            </li>
                        {% endfor %}
                    </ul>

                </div>
            {% endfor %}
            <br>
        {% endfor %}
    </div>
    <div class="spacing"></div>
{% endblock %}
